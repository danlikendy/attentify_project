<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attentify - Интерактивная платформа Transformer</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        /* ===== ЕДИНАЯ НАВИГАЦИОННАЯ ПАНЕЛЬ ===== */
        .navbar {
            background: #2c3e50;
            padding: 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 2px solid #8B4513;
        }

        .navbar-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: #d4af37;
            font-weight: bold;
            font-size: 1.5rem;
            transition: color 0.3s;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .navbar-brand:hover {
            color: #f4d03f;
        }

        .navbar-logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #d4af37 0%, #b8860b 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .navbar-menu {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .navbar-menu li {
            margin: 0 15px;
        }

        .navbar-menu a {
            color: white;
            text-decoration: none;
            padding: 20px 0;
            display: block;
            transition: color 0.3s;
            font-weight: 500;
        }

        .navbar-menu a:hover {
            color: #d4af37;
        }

        .navbar-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .navbar-btn {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .navbar-btn:hover {
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.5);
        }

        .navbar-btn.primary {
            background: linear-gradient(135deg, #d4af37 0%, #b8860b 100%);
            border-color: transparent;
            color: white;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .navbar-btn.primary:hover {
            background: linear-gradient(135deg, #f4d03f 0%, #d4af37 100%);
        }

        /* ===== ОСНОВНЫЕ СТИЛИ ===== */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        /* ===== ЕДИНЫЙ СТИЛЬ ДЛЯ ВСЕХ ПАНЕЛЕЙ ===== */
        .panel, .attention-visualization {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .panel h2, .attention-visualization h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .panel p, .attention-visualization p {
            color: #555;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        /* ===== СЕТКА КОНТЕНТА ===== */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        /* ===== ФОРМЫ И КНОПКИ ===== */
        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .input-group input,
        .input-group textarea,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: #3498db;
        }

        .input-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #229954);
        }

        /* ===== КАРТОЧКИ ВОЗМОЖНОСТЕЙ ===== */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 20px;
        }

        .feature-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            transition: transform 0.3s;
            border: 2px solid #e9ecef;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 20px;
        }

        .feature-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .feature-card p {
            color: #555;
            line-height: 1.6;
        }

        /* ===== УПРАВЛЕНИЕ МОДЕЛЬЮ ===== */
        .model-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .control-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .control-item label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .control-item input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* ===== ВИЗУАЛИЗАЦИЯ ВНИМАНИЯ ===== */
        .attention-visualization {
            grid-column: 1 / -1;
        }

        .attention-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .attention-layer {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e9ecef;
        }

        .attention-layer h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }

        .heatmap-container {
            width: 100%;
            height: 200px;
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
        }

        /* ===== СЕКЦИЯ "О ПРОЕКТЕ" ===== */
        .about-content {
            margin-top: 20px;
        }

        .about-section {
            margin-bottom: 40px;
        }

        .about-section:last-child {
            margin-bottom: 0;
        }

        .about-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8rem;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .about-section p {
            color: #555;
            line-height: 1.8;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .about-section ul {
            color: #555;
            line-height: 1.8;
            margin-left: 20px;
            font-size: 1.1rem;
        }

        .about-section li {
            margin-bottom: 10px;
        }

        .tech-stack {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .tech-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e9ecef;
        }

        .tech-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .tech-item h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .tech-item p {
            color: #666;
            font-size: 0.9rem;
        }

        /* ===== БЛОГ ===== */
        .blog-preview {
            margin-top: 20px;
        }

        .blog-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
        }

        .blog-item h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .blog-item p {
            color: #555;
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .blog-date {
            color: #7f8c8d;
            font-size: 0.9rem;
            font-style: italic;
        }

        /* ===== РЕЗУЛЬТАТЫ ===== */
        .results {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #3498db;
        }

        .results h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .result-text {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #3498db;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #f5c6cb;
            margin-top: 15px;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #c3e6cb;
            margin-top: 15px;
        }

        /* ===== ТЕМНАЯ ТЕМА ===== */
        .dark-theme {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        .dark-theme .panel,
        .dark-theme .attention-visualization {
            background: #2c3e50;
            color: #ecf0f1;
        }

        .dark-theme .panel h2,
        .dark-theme .attention-visualization h2 {
            color: #ecf0f1;
            border-bottom-color: #3498db;
        }

        .dark-theme .input-group label {
            color: #ecf0f1;
        }

        .dark-theme .control-item {
            background: #34495e;
            border-color: #2c3e50;
        }

        .dark-theme .control-item label {
            color: #ecf0f1;
        }

        .dark-theme .blog-item,
        .dark-theme .feature-card,
        .dark-theme .tech-item {
            background: #34495e;
            border-color: #2c3e50;
        }

        .dark-theme .blog-item h3,
        .dark-theme .feature-card h3,
        .dark-theme .tech-item h4 {
            color: #ecf0f1;
        }

        .dark-theme .blog-item p,
        .dark-theme .feature-card p,
        .dark-theme .tech-item p {
            color: #bdc3c7;
        }

        .dark-theme .about-section h3 {
            color: #ecf0f1;
            border-bottom-color: #3498db;
        }

        .dark-theme .about-section p,
        .dark-theme .about-section ul {
            color: #bdc3c7;
        }

        /* ===== АДАПТИВНОСТЬ ===== */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 15px;
            }

            .navbar-container {
                flex-direction: column;
                padding: 10px 20px;
            }

            .navbar-menu {
                margin: 15px 0;
                flex-wrap: wrap;
                justify-content: center;
            }

            .navbar-menu li {
                margin: 5px 10px;
            }

            .navbar-actions {
                margin-top: 10px;
            }

            .navbar-brand {
                font-size: 1.3rem;
            }

            .navbar-logo {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }

            .features-grid,
            .tech-stack {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="navbar">
        <div class="navbar-container">
            <a href="index.html" class="navbar-brand">
                <span class="navbar-logo">A</span>
                Attentify
            </a>
            <ul class="navbar-menu">
                <li><a href="#features">ВОЗМОЖНОСТИ</a></li>
                <li><a href="#demo">ДЕМО</a></li>
                <li><a href="#model-params">ПАРАМЕТРЫ</a></li>
                <li><a href="#about">О ПРОЕКТЕ</a></li>
                <li><a href="#blog">БЛОГ</a></li>
                <li><a href="#docs">ДОКУМЕНТАЦИЯ</a></li>
            </ul>
            <div class="navbar-actions">
                <button class="navbar-btn" id="themeToggle">🌞</button>
                <button class="navbar-btn" id="languageToggle">RU</button>
                <button class="navbar-btn primary">API Документация</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>🧠 Attentify</h1>
            <p>Интерактивная платформа для изучения архитектуры Transformer</p>
        </div>

        <div class="main-content">
            <!-- Панель ввода -->
            <div class="panel" id="demo">
                <h2>📝 Ввод текста</h2>
                
                <div class="input-group">
                    <label for="taskType">Тип задачи:</label>
                    <select id="taskType">
                        <option value="translation">Перевод</option>
                        <option value="summarization">Резюмирование</option>
                        <option value="simplification">Упрощение</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="sourceText">Исходный текст:</label>
                    <textarea id="sourceText" placeholder="Введите текст для обработки...">The transformer architecture has revolutionized natural language processing by introducing the attention mechanism that allows the model to focus on different parts of the input sequence when processing each element.</textarea>
                </div>

                <div class="input-group">
                    <label for="maxLength">Максимальная длина результата:</label>
                    <input type="number" id="maxLength" value="100" min="10" max="500">
                </div>

                <button class="btn" onclick="processText()">🚀 Обработать текст</button>
                <button class="btn btn-secondary" onclick="clearResults()">🗑️ Очистить</button>
            </div>

            <!-- Панель управления моделью -->
            <div class="panel" id="model-params">
                <h2>⚙️ Параметры модели</h2>
                
                <div class="model-controls">
                    <div class="control-item">
                        <label for="numLayers">Количество слоев:</label>
                        <input type="number" id="numLayers" value="6" min="1" max="12">
                    </div>
                    
                    <div class="control-item">
                        <label for="numHeads">Количество голов внимания:</label>
                        <input type="number" id="numHeads" value="8" min="1" max="16">
                    </div>
                    
                    <div class="control-item">
                        <label for="dModel">Размерность модели:</label>
                        <input type="number" id="dModel" value="512" min="64" max="1024" step="64">
                    </div>
                    
                    <div class="control-item">
                        <label for="dFF">Размерность FFN:</label>
                        <input type="number" id="dFF" value="2048" min="256" max="4096" step="256">
                    </div>
                </div>

                <button class="btn btn-success" onclick="updateModel()">🔄 Обновить модель</button>
                <button class="btn btn-secondary" onclick="getModelInfo()">ℹ️ Информация о модели</button>
            </div>
        </div>

        <!-- Возможности платформы -->
        <div class="panel" id="features">
            <h2>🚀 Возможности платформы</h2>
            <p>Изучите все возможности Attentify для работы с Transformer архитектурой</p>
            
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">🧠</div>
                    <h3>Многослойные Transformer</h3>
                    <p>Создавайте и настраивайте модели с различным количеством слоев, от 1 до 12, для оптимального баланса между производительностью и качеством.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">👁️</div>
                    <h3>Визуализация внимания</h3>
                    <p>Интерактивные heatmap для каждого слоя модели, показывающие, на какие части входного текста обращает внимание модель при генерации.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">🔧</div>
                    <h3>Гибкая настройка</h3>
                    <p>Настраивайте количество голов внимания, размерность модели и размерность feed-forward сети для достижения лучших результатов.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">📝</div>
                    <h3>Множество задач</h3>
                    <p>Поддержка различных NLP задач: перевод, резюмирование, упрощение текста и многое другое.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">⚡</div>
                    <h3>Высокая производительность</h3>
                    <p>Оптимизированные алгоритмы и эффективное использование памяти для быстрой обработки больших текстов.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">🎯</div>
                    <h3>Точные результаты</h3>
                    <p>Продвинутые алгоритмы обучения и валидации для получения высококачественных результатов обработки текста.</p>
                </div>
            </div>
        </div>

        <!-- Визуализация внимания -->
        <div class="attention-visualization" id="attention">
            <h2>👁️ Визуализация механизма внимания</h2>
            <p>Здесь будет отображаться heatmap внимания для каждого слоя модели</p>
            
            <div class="attention-grid" id="attentionGrid">
                <!-- Attention layers will be populated here -->
            </div>
        </div>

        <!-- О проекте -->
        <div class="panel" id="about">
            <h2>ℹ️ О проекте</h2>
            <p>Узнайте больше о платформе Attentify и её возможностях</p>
            
            <div class="about-content">
                <div class="about-section">
                    <h3>🎯 Наша миссия</h3>
                    <p>Attentify - это инновационная платформа, созданная для демонстрации и изучения архитектуры Transformer. Мы стремимся сделать сложные концепции машинного обучения доступными и понятными для всех, кто интересуется искусственным интеллектом.</p>
                    <p>Наша цель - предоставить интерактивный инструмент для изучения механизмов внимания, которые лежат в основе современных языковых моделей.</p>
                </div>

                <div class="about-section">
                    <h3>🧠 Что такое Transformer?</h3>
                    <p>Transformer - это революционная архитектура нейронных сетей, представленная в 2017 году в статье "Attention Is All You Need". Она заменила традиционные рекуррентные нейронные сети (RNN) и стала основой для таких моделей как GPT, BERT и T5.</p>
                    <p>Ключевая особенность Transformer - механизм внимания (attention mechanism), который позволяет модели "сосредотачиваться" на различных частях входного текста при генерации каждого слова.</p>
                </div>

                <div class="about-section">
                    <h3>🚀 Технологический стек</h3>
                    <p>Платформа Attentify построена с использованием современных технологий:</p>
                    <div class="tech-stack">
                        <div class="tech-item">
                            <div class="tech-icon">🐍</div>
                            <h4>Python</h4>
                            <p>Основной язык программирования</p>
                        </div>
                        <div class="tech-item">
                            <div class="tech-icon">⚡</div>
                            <h4>FastAPI</h4>
                            <p>Современный веб-фреймворк</p>
                        </div>
                        <div class="tech-item">
                            <div class="tech-icon">🔥</div>
                            <h4>PyTorch</h4>
                            <p>Библиотека машинного обучения</p>
                        </div>
                        <div class="tech-item">
                            <div class="tech-icon">🎨</div>
                            <h4>HTML5/CSS3</h4>
                            <p>Современные веб-технологии</p>
                        </div>
                    </div>
                </div>

                <div class="about-section">
                    <h3>📈 Планы развития</h3>
                    <p>Мы постоянно работаем над улучшением платформы. В ближайших планах:</p>
                    <ul>
                        <li>Добавление новых типов задач обработки текста</li>
                        <li>Улучшение визуализации механизмов внимания</li>
                        <li>Интеграция с популярными предобученными моделями</li>
                        <li>Создание API для разработчиков</li>
                        <li>Добавление обучающих материалов и курсов</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Результаты -->
        <div class="panel" id="docs">
            <h2>📊 Результаты обработки</h2>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Обрабатываем текст...</p>
            </div>

            <div id="results" class="results" style="display: none;">
                <h3>Результат:</h3>
                <div id="resultText" class="result-text"></div>
            </div>

            <div id="error" class="error" style="display: none;"></div>
        </div>

        <!-- Блог -->
        <div class="panel" id="blog">
            <h2>📝 Блог</h2>
            <p>Здесь будут публиковаться статьи о новых возможностях платформы, обновлениях и технических деталях.</p>
            <div class="blog-preview">
                <div class="blog-item">
                    <h3>🎯 Новые возможности Transformer</h3>
                    <p>Изучите последние достижения в области архитектуры Transformer и их применение в NLP.</p>
                    <span class="blog-date">15 декабря 2024</span>
                </div>
                <div class="blog-item">
                    <h3>🚀 Оптимизация производительности</h3>
                    <p>Советы по улучшению скорости работы моделей и снижению потребления памяти.</p>
                    <span class="blog-date">10 декабря 2024</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Глобальные переменные
        let currentAttentionWeights = null;
        let currentSourceText = '';
        let currentTargetText = '';

        // Основные функции
        async function processText() {
            const sourceText = document.getElementById('sourceText').value.trim();
            const taskType = document.getElementById('taskType').value;
            const maxLength = parseInt(document.getElementById('maxLength').value);

            if (!sourceText) {
                showError('Пожалуйста, введите текст для обработки');
                return;
            }

            showLoading(true);
            hideError();
            hideResults();

            try {
                const response = await fetch(`/api/process`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        text: sourceText,
                        task: taskType,
                        parameters: JSON.stringify({ max_length: maxLength })
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    showResults(data);
                    currentSourceText = sourceText;
                    currentTargetText = data.result;
                    
                    // Получаем веса внимания для визуализации
                    await getAttentionWeights(sourceText, data.result);
                } else {
                    showError(data.detail || 'Ошибка при обработке текста');
                }
            } catch (error) {
                showError(`Ошибка сети: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }

        async function getAttentionWeights(sourceText, targetText) {
            try {
                const response = await fetch(`/api/attention`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        source_text: sourceText,
                        target_text: targetText
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    currentAttentionWeights = data.attention_weights;
                    visualizeAttention();
                } else {
                    console.error('Ошибка при получении весов внимания:', data.detail);
                }
            } catch (error) {
                console.error('Ошибка при получении весов внимания:', error);
            }
        }

        function visualizeAttention() {
            if (!currentAttentionWeights) return;

            const grid = document.getElementById('attentionGrid');
            grid.innerHTML = '';

            Object.entries(currentAttentionWeights).forEach(([layerName, weights]) => {
                if (weights && weights.length > 0) {
                    const layerDiv = document.createElement('div');
                    layerDiv.className = 'attention-layer';
                    
                    const title = document.createElement('h4');
                    title.textContent = layerName.replace(/_/g, ' ').toUpperCase();
                    layerDiv.appendChild(title);

                    const heatmapContainer = document.createElement('div');
                    heatmapContainer.className = 'heatmap-container';
                    heatmapContainer.id = `heatmap-${layerName}`;
                    layerDiv.appendChild(heatmapContainer);

                    grid.appendChild(layerDiv);

                    // Создаем heatmap с помощью D3.js
                    createHeatmap(weights, `heatmap-${layerName}`, layerName);
                }
            });
        }

        function createHeatmap(weights, containerId, layerName) {
            const container = document.getElementById(containerId);
            const width = container.offsetWidth;
            const height = container.offsetHeight;

            // Очищаем контейнер
            container.innerHTML = '';

            // Создаем SVG
            const svg = d3.select(container)
                .append('svg')
                .attr('width', width)
                .attr('height', height);

            // Подготавливаем данные
            const data = [];
            for (let i = 0; i < weights.length; i++) {
                for (let j = 0; j < weights[i].length; j++) {
                    data.push({
                        x: j,
                        y: i,
                        value: weights[i][j]
                    });
                }
            }

            // Масштабирование
            const xScale = d3.scaleLinear()
                .domain([0, weights[0].length])
                .range([0, width]);

            const yScale = d3.scaleLinear()
                .domain([0, weights.length])
                .range([0, height]);

            // Цветовая шкала
            const colorScale = d3.scaleSequential(d3.interpolateBlues)
                .domain([0, d3.max(data, d => d.value)]);

            // Создаем прямоугольники для каждого значения
            svg.selectAll('rect')
                .data(data)
                .enter()
                .append('rect')
                .attr('x', d => xScale(d.x))
                .attr('y', d => yScale(d.y))
                .attr('width', width / weights[0].length)
                .attr('height', height / weights.length)
                .attr('fill', d => colorScale(d.value))
                .attr('stroke', '#fff')
                .attr('stroke-width', 0.5)
                .append('title')
                .text(d => `Layer: ${layerName}\nPosition: (${d.x}, ${d.y})\nWeight: ${d.value.toFixed(4)}`);
        }

        async function updateModel() {
            const numLayers = parseInt(document.getElementById('numLayers').value);
            const numHeads = parseInt(document.getElementById('numHeads').value);
            const dModel = parseInt(document.getElementById('dModel').value);
            const dFF = parseInt(document.getElementById('dFF').value);

            showLoading(true);
            hideError();

            try {
                // В реальном приложении здесь был бы API call для обновления модели
                // Пока просто показываем сообщение об успехе
                setTimeout(() => {
                    showSuccess(`Модель обновлена! Новые параметры: ${numLayers} слоев, ${numHeads} голов, d_model=${dModel}, d_ff=${dFF}`);
                    showLoading(false);
                }, 1000);
            } catch (error) {
                showError(`Ошибка при обновлении модели: ${error.message}`);
                showLoading(false);
            }
        }

        async function getModelInfo() {
            try {
                const response = await fetch('/api/model-info');
                const data = await response.json();

                if (response.ok) {
                    const infoText = `Архитектура: ${data.architecture}
Параметры:
- d_model: ${data.parameters.d_model}
- n_layers: ${data.parameters.n_layers}
- n_heads: ${data.parameters.n_heads}
- d_ff: ${data.parameters.d_ff}
- dropout: ${data.parameters.dropout}

Словарь:
- Источник: ${data.vocabulary.source_size} токенов
- Цель: ${data.vocabulary.target_size} токенов

Всего параметров: ${data.total_parameters.toLocaleString()}
Обучаемых параметров: ${data.trainable_parameters.toLocaleString()}`;

                    showResults({
                        result: infoText,
                        task: 'model_info'
                    });
                } else {
                    showError(data.detail || 'Ошибка при получении информации о модели');
                }
            } catch (error) {
                showError(`Ошибка сети: ${error.message}`);
            }
        }

        function clearResults() {
            hideResults();
            hideError();
            document.getElementById('sourceText').value = '';
            document.getElementById('attentionGrid').innerHTML = '';
            currentAttentionWeights = null;
        }

        // Вспомогательные функции
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function showResults(data) {
            const resultsDiv = document.getElementById('results');
            const resultTextDiv = document.getElementById('resultText');
            
            resultTextDiv.textContent = data.result;
            resultsDiv.style.display = 'block';
        }

        function hideResults() {
            document.getElementById('results').style.display = 'none';
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function hideError() {
            document.getElementById('error').style.display = 'none';
        }

        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.textContent = message;
            
            const container = document.querySelector('.container');
            container.appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.remove();
            }, 5000);
        }

        // Навигация
        function handleNavigation(event, section) {
            event.preventDefault();
            
            // Прокручиваем к соответствующему разделу на текущей странице
            const targetElement = document.getElementById(section);
            if (targetElement) {
                targetElement.scrollIntoView({ behavior: 'smooth' });
            } else {
                // Если раздел не найден, показываем сообщение
                showSuccess(`Переход к разделу: ${section}`);
            }
        }

        function goToMainPage() {
            // Переход на главную страницу (текущая страница)
            window.scrollTo({ top: 0, behavior: 'smooth' });
            showSuccess('Главная страница');
        }

        // Переключение темы
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.getElementById('themeToggle');
            
            if (body.classList.contains('dark-theme')) {
                body.classList.remove('dark-theme');
                themeToggle.textContent = '🌞';
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.add('dark-theme');
                themeToggle.textContent = '🌙';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Переключение языка
        function toggleLanguage() {
            const languageToggle = document.getElementById('languageToggle');
            const currentLang = languageToggle.textContent;
            
            if (currentLang === 'RU') {
                languageToggle.textContent = 'EN';
                localStorage.setItem('language', 'en');
                translateToEnglish();
                showSuccess('Язык изменен на английский');
            } else {
                languageToggle.textContent = 'RU';
                localStorage.setItem('language', 'ru');
                translateToRussian();
                showSuccess('Язык изменен на русский');
            }
        }

        // Перевод на английский
        function translateToEnglish() {
            const translations = {
                'Интерактивная платформа для изучения архитектуры Transformer': 'Interactive platform for studying Transformer architecture',
                'Ввод текста': 'Text Input',
                'Тип задачи:': 'Task Type:',
                'Перевод': 'Translation',
                'Резюмирование': 'Summarization',
                'Упрощение': 'Simplification',
                'Исходный текст:': 'Source Text:',
                'Введите текст для обработки...': 'Enter text for processing...',
                'Максимальная длина результата:': 'Maximum result length:',
                'Обработать текст': 'Process Text',
                'Очистить': 'Clear',
                'Параметры модели': 'Model Parameters',
                'Количество слоев:': 'Number of layers:',
                'Количество голов внимания:': 'Number of attention heads:',
                'Размерность модели:': 'Model dimension:',
                'Размерность FFN:': 'FFN dimension:',
                'Обновить модель': 'Update Model',
                'Информация о модели': 'Model Information',
                'ПАРАМЕТРЫ': 'PARAMETERS',
                'Возможности платформы': 'Platform Features',
                'Изучите все возможности Attentify для работы с Transformer архитектурой': 'Explore all Attentify capabilities for working with Transformer architecture',
                'Многослойные Transformer': 'Multi-layer Transformers',
                'Создавайте и настраивайте модели с различным количеством слоев, от 1 до 12, для оптимального баланса между производительностью и качеством.': 'Create and configure models with different numbers of layers, from 1 to 12, for optimal balance between performance and quality.',
                'Визуализация внимания': 'Attention Visualization',
                'Интерактивные heatmap для каждого слоя модели, показывающие, на какие части входного текста обращает внимание модель при генерации.': 'Interactive heatmaps for each model layer showing which parts of the input text the model pays attention to during generation.',
                'Гибкая настройка': 'Flexible Configuration',
                'Настраивайте количество голов внимания, размерность модели и размерность feed-forward сети для достижения лучших результатов.': 'Configure the number of attention heads, model dimension and feed-forward network dimension for better results.',
                'Множество задач': 'Multiple Tasks',
                'Поддержка различных NLP задач: перевод, резюмирование, упрощение текста и многое другое.': 'Support for various NLP tasks: translation, summarization, text simplification and much more.',
                'Высокая производительность': 'High Performance',
                'Оптимизированные алгоритмы и эффективное использование памяти для быстрой обработки больших текстов.': 'Optimized algorithms and efficient memory usage for fast processing of large texts.',
                'Точные результаты': 'Accurate Results',
                'Продвинутые алгоритмы обучения и валидации для получения высококачественных результатов обработки текста.': 'Advanced training and validation algorithms for high-quality text processing results.',
                'О проекте': 'About Project',
                'Узнайте больше о платформе Attentify и её возможностях': 'Learn more about the Attentify platform and its capabilities',
                'Наша миссия': 'Our Mission',
                'Attentify - это инновационная платформа, созданная для демонстрации и изучения архитектуры Transformer. Мы стремимся сделать сложные концепции машинного обучения доступными и понятными для всех, кто интересуется искусственным интеллектом.': 'Attentify is an innovative platform created to demonstrate and study Transformer architecture. We strive to make complex machine learning concepts accessible and understandable to everyone interested in artificial intelligence.',
                'Наша цель - предоставить интерактивный инструмент для изучения механизмов внимания, которые лежат в основе современных языковых моделей.': 'Our goal is to provide an interactive tool for studying attention mechanisms that underlie modern language models.',
                'Что такое Transformer?': 'What is Transformer?',
                'Transformer - это революционная архитектура нейронных сетей, представленная в 2017 году в статье "Attention Is All You Need". Она заменила традиционные рекуррентные нейронные сети (RNN) и стала основой для таких моделей как GPT, BERT и T5.': 'Transformer is a revolutionary neural network architecture presented in 2017 in the paper "Attention Is All You Need". It replaced traditional recurrent neural networks (RNN) and became the foundation for models such as GPT, BERT and T5.',
                'Ключевая особенность Transformer - механизм внимания (attention mechanism), который позволяет модели "сосредотачиваться" на различных частях входного текста при генерации каждого слова.': 'The key feature of Transformer is the attention mechanism, which allows the model to "focus" on different parts of the input text when generating each word.',
                'Технологический стек': 'Technology Stack',
                'Платформа Attentify построена с использованием современных технологий:': 'The Attentify platform is built using modern technologies:',
                'Основной язык программирования': 'Main programming language',
                'Современный веб-фреймворк': 'Modern web framework',
                'Библиотека машинного обучения': 'Machine learning library',
                'Современные веб-технологии': 'Modern web technologies',
                'Планы развития': 'Development Plans',
                'Мы постоянно работаем над улучшением платформы. В ближайших планах:': 'We are constantly working to improve the platform. In the near future:',
                'Добавление новых типов задач обработки текста': 'Adding new types of text processing tasks',
                'Улучшение визуализации механизмов внимания': 'Improving attention mechanism visualization',
                'Интеграция с популярными предобученными моделями': 'Integration with popular pre-trained models',
                'Создание API для разработчиков': 'Creating API for developers',
                'Добавление обучающих материалов и курсов': 'Adding educational materials and courses',
                'Визуализация механизма внимания': 'Attention Mechanism Visualization',
                'Здесь будет отображаться heatmap внимания для каждого слоя модели': 'Attention heatmap for each model layer will be displayed here',
                'Результаты обработки': 'Processing Results',
                'Обрабатываем текст...': 'Processing text...',
                'Результат:': 'Result:',
                'Блог': 'Blog',
                'Здесь будут публиковаться статьи о новых возможностях платформы, обновлениях и технических деталях.': 'Articles about new platform features, updates and technical details will be published here.',
                'Новые возможности Transformer': 'New Transformer Features',
                'Изучите последние достижения в области архитектуры Transformer и их применение в NLP.': 'Explore the latest advances in Transformer architecture and their applications in NLP.',
                'Оптимизация производительности': 'Performance Optimization',
                'Советы по улучшению скорости работы моделей и снижению потребления памяти.': 'Tips for improving model speed and reducing memory consumption.',
                'Главная страница': 'Main Page'
            };

            Object.keys(translations).forEach(russianText => {
                const englishText = translations[russianText];
                replaceText(russianText, englishText);
            });
        }

        // Перевод на русский
        function translateToRussian() {
            const translations = {
                'Interactive platform for studying Transformer architecture': 'Интерактивная платформа для изучения архитектуры Transformer',
                'Text Input': 'Ввод текста',
                'Task Type:': 'Тип задачи:',
                'Translation': 'Перевод',
                'Summarization': 'Резюмирование',
                'Simplification': 'Упрощение',
                'Source Text:': 'Исходный текст:',
                'Enter text for processing...': 'Введите текст для обработки...',
                'Maximum result length:': 'Максимальная длина результата:',
                'Process Text': 'Обработать текст',
                'Clear': 'Очистить',
                'Model Parameters': 'Параметры модели',
                'Number of layers:': 'Количество слоев:',
                'Number of attention heads:': 'Количество голов внимания:',
                'Model dimension:': 'Размерность модели:',
                'FFN dimension:': 'Размерность FFN:',
                'Update Model': 'Обновить модель',
                'Model Information': 'Информация о модели',
                'PARAMETERS': 'ПАРАМЕТРЫ',
                'Platform Features': 'Возможности платформы',
                'Explore all Attentify capabilities for working with Transformer architecture': 'Изучите все возможности Attentify для работы с Transformer архитектурой',
                'Multi-layer Transformers': 'Многослойные Transformer',
                'Create and configure models with different numbers of layers, from 1 to 12, for optimal balance between performance and quality.': 'Создавайте и настраивайте модели с различным количеством слоев, от 1 до 12, для оптимального баланса между производительностью и качеством.',
                'Attention Visualization': 'Визуализация внимания',
                'Interactive heatmaps for each model layer showing which parts of the input text the model pays attention to during generation.': 'Интерактивные heatmap для каждого слоя модели, показывающие, на какие части входного текста обращает внимание модель при генерации.',
                'Flexible Configuration': 'Гибкая настройка',
                'Configure the number of attention heads, model dimension and feed-forward network dimension for better results.': 'Настраивайте количество голов внимания, размерность модели и размерность feed-forward сети для достижения лучших результатов.',
                'Multiple Tasks': 'Множество задач',
                'Support for various NLP tasks: translation, summarization, text simplification and much more.': 'Поддержка различных NLP задач: перевод, резюмирование, упрощение текста и многое другое.',
                'High Performance': 'Высокая производительность',
                'Optimized algorithms and efficient memory usage for fast processing of large texts.': 'Оптимизированные алгоритмы и эффективное использование памяти для быстрой обработки больших текстов.',
                'Accurate Results': 'Точные результаты',
                'Advanced training and validation algorithms for high-quality text processing results.': 'Продвинутые алгоритмы обучения и валидации для получения высококачественных результатов обработки текста.',
                'About Project': 'О проекте',
                'Learn more about the Attentify platform and its capabilities': 'Узнайте больше о платформе Attentify и её возможностях',
                'Our Mission': 'Наша миссия',
                'Attentify is an innovative platform created to demonstrate and study Transformer architecture. We strive to make complex machine learning concepts accessible and understandable to everyone interested in artificial intelligence.': 'Attentify - это инновационная платформа, созданная для демонстрации и изучения архитектуры Transformer. Мы стремимся сделать сложные концепции машинного обучения доступными и понятными для всех, кто интересуется искусственным интеллектом.',
                'Our goal is to provide an interactive tool for studying attention mechanisms that underlie modern language models.': 'Наша цель - предоставить интерактивный инструмент для изучения механизмов внимания, которые лежат в основе современных языковых моделей.',
                'What is Transformer?': 'Что такое Transformer?',
                'Transformer is a revolutionary neural network architecture presented in 2017 in the paper "Attention Is All You Need". It replaced traditional recurrent neural networks (RNN) and became the foundation for models such as GPT, BERT and T5.': 'Transformer - это революционная архитектура нейронных сетей, представленная в 2017 году в статье "Attention Is All You Need". Она заменила традиционные рекуррентные нейронные сети (RNN) и стала основой для таких моделей как GPT, BERT и T5.',
                'The key feature of Transformer is the attention mechanism, which allows the model to "focus" on different parts of the input text when generating each word.': 'Ключевая особенность Transformer - механизм внимания (attention mechanism), который позволяет модели "сосредотачиваться" на различных частях входного текста при генерации каждого слова.',
                'Technology Stack': 'Технологический стек',
                'The Attentify platform is built using modern technologies:': 'Платформа Attentify построена с использованием современных технологий:',
                'Main programming language': 'Основной язык программирования',
                'Modern web framework': 'Современный веб-фреймворк',
                'Machine learning library': 'Библиотека машинного обучения',
                'Modern web technologies': 'Современные веб-технологии',
                'Development Plans': 'Планы развития',
                'We are constantly working to improve the platform. In the near future:': 'Мы постоянно работаем над улучшением платформы. В ближайших планах:',
                'Adding new types of text processing tasks': 'Добавление новых типов задач обработки текста',
                'Improving attention mechanism visualization': 'Улучшение визуализации механизмов внимания',
                'Integration with popular pre-trained models': 'Интеграция с популярными предобученными моделями',
                'Creating API for developers': 'Создание API для разработчиков',
                'Adding educational materials and courses': 'Добавление обучающих материалов и курсов',
                'Attention Mechanism Visualization': 'Визуализация механизма внимания',
                'Attention heatmap for each model layer will be displayed here': 'Здесь будет отображаться heatmap внимания для каждого слоя модели',
                'Processing Results': 'Результаты обработки',
                'Processing text...': 'Обрабатываем текст...',
                'Result:': 'Результат:',
                'Blog': 'Блог',
                'Articles about new platform features, updates and technical details will be published here.': 'Здесь будут публиковаться статьи о новых возможностях платформы, обновлениях и технических деталях.',
                'New Transformer Features': 'Новые возможности Transformer',
                'Explore the latest advances in Transformer architecture and their applications in NLP.': 'Изучите последние достижения в области архитектуры Transformer и их применении в NLP.',
                'Performance Optimization': 'Оптимизация производительности',
                'Tips for improving model speed and reducing memory consumption.': 'Советы по улучшению скорости работы моделей и снижению потребления памяти.',
                'Main Page': 'Главная страница'
            };

            Object.keys(translations).forEach(englishText => {
                const russianText = translations[englishText];
                replaceText(englishText, russianText);
            });
        }

        // Функция замены текста
        function replaceText(oldText, newText) {
            const walker = document.createTreeWalker(
                document.body,
                NodeFilter.SHOW_TEXT,
                null,
                false
            );

            let node;
            while (node = walker.nextNode()) {
                if (node.textContent.trim() === oldText) {
                    node.textContent = newText;
                }
            }
        }

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Attentify Platform загружена!');
            
            // Загружаем сохраненные настройки
            const savedTheme = localStorage.getItem('theme');
            const savedLanguage = localStorage.getItem('language');
            
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
                document.getElementById('themeToggle').textContent = '🌙';
            }
            
            if (savedLanguage === 'en') {
                document.getElementById('languageToggle').textContent = 'EN';
            }
            
            // Добавляем обработчики для навигации
            document.querySelector('.navbar-brand').addEventListener('click', function(e) {
                e.preventDefault();
                goToMainPage();
            });
            
            // Добавляем обработчики для пунктов меню
            document.querySelectorAll('.navbar-menu a').forEach(link => {
                link.addEventListener('click', function(e) {
                    const section = this.getAttribute('href').substring(1);
                    handleNavigation(e, section);
                });
            });
            
            // Добавляем обработчики для кнопок
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            document.getElementById('languageToggle').addEventListener('click', toggleLanguage);
            
            // Проверяем статус системы
            fetch('/health')
                .then(response => response.json())
                .then(data => {
                    if (data.model_loaded) {
                        console.log('Модель загружена успешно');
                    } else {
                        console.log('Модель не загружена');
                    }
                })
                .catch(error => {
                    console.error('Ошибка при проверке статуса:', error);
                });
        });
    </script>
</body>
</html>
